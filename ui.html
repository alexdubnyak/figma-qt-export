<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Qt UI Export</title>
  <style>
    body    { font: 13px/1.4 sans-serif; margin: 16px; }
    button  { padding: 6px 14px; font-size: 13px; }
    #status { margin-top: 12px; white-space: pre-wrap; }
    a.dl    { display: block; margin-top: 8px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>
<body>

  <button id="exportBtn">Export Qt UI</button>
  <div id="status"></div>

  <script>
    const status = document.getElementById('status');

    document.getElementById('exportBtn').onclick = () => {
      parent.postMessage({ pluginMessage: { type: 'export' } }, '*');
      status.textContent = '‚è≥ –≠–∫—Å–ø–æ—Ä—Ç...';
    };

    window.onmessage = async (event) => {
      const msg = event.data.pluginMessage;
      if (!msg || msg.type !== 'files' || typeof msg.files !== 'object') return;

      const files = msg.files;
      const zip = new JSZip();

      console.log('üì¶ –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:', files);

      // –¢–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∫–ª—é—á–∏ ‚Äî –∏–∑–±–µ–≥–∞–µ–º —Å–∏–º–≤–æ–ª–æ–≤ –∏ –ø–ª–æ—Ö–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
      for (const [key, val] of Object.entries(files)) {
        if (typeof key === 'string') {
          try {
            zip.file(key, String(val));
          } catch (e) {
            console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª:', key, e);
          }
        } else {
          console.warn('üö´ –°–∏–º–≤–æ–ª –∏–ª–∏ –Ω–µ—Å—Ç—Ä–æ–∫–æ–≤–æ–π –∫–ª—é—á –ø—Ä–æ–ø—É—â–µ–Ω:', key);
        }
      }

      const blob = await zip.generateAsync({ type: 'blob' });
      const url = URL.createObjectURL(blob);

      status.innerHTML = '‚úÖ –§–∞–π–ª—ã –≥–æ—Ç–æ–≤—ã.';
      const a = document.createElement('a');
      a.href = url;
      a.download = 'qt-ui-export.zip';
      a.className = 'dl';
      a.textContent = 'üì¶ –°–∫–∞—á–∞—Ç—å ZIP';
      status.appendChild(a);
    };
  </script>
</body>
</html>
